<html>
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta content="true" name="HandheldFriendly"/>
    <meta content="width" name="MobileOptimized"/>
    <meta content="yes" name="apple-mobile-web-app-capable"/>
    <meta property="og:image" content="/img/preview.webp"/>

    <meta property="og:type" content="website"/>
    <meta property="og:title" content="Свадебное приглашение Даниил и Екатерина!"/>
    <meta property="og:image" content="https://ye-story.github.io/e-d.04-09.invite/img/preview.webp"/>
    <meta property="og:site_name" content="E & D"/>
    <meta
            property="og:description"
            content="Свадебное приглашение Даниил и Екатерина!"
    />

    <meta property="og:url" content="https://ye-story.github.io/e-d.04-09.invite/"/>

    <link rel="stylesheet" type="text/css" href="styles.css"/>
    <title>E & D</title>
</head>

<body style="overflow: hidden">


<main>
    <div class="img-wrapper">
        <img src="" alt="" id="img1"/>

        <div class="locker" id="locker">

            <div class="locker__container">
                <p>Разблокируйте<br>приглашение</p>
                <div class="locker__track">
                    <div class="locker__track_arrow" id="arrow"></div>
                    <div class="locker__track_dots">
                        <span>·</span>
                        <span>·</span>
                        <span>·</span>
                        <span>·</span>
                        <span>·</span>
                        <span>·</span>
                    </div>
                    <div class="locker__track_round" id="round"></div>
                </div>

            </div>
        </div>
    </div>
    <!--<img src="./assets/scroll-down-mouse-white.gif" class="scroll-img" />-->
</main>

<script src="script.js?1001"></script>

<script>
    const locker = document.getElementById('locker');
    const arrow = document.getElementById('arrow');
    const round = document.getElementById('round');
    const imgWrapper = document.querySelector('.img-wrapper');

    const track = document.querySelector('.locker__track');

    const audio = new Audio('assets/sound.mp3');
    audio.loop = true;
    audio.load();

    let isAudioStarted = false;

    const hideDots = (time = 600) => {
        const dots = [...document.querySelectorAll('.locker__track_dots span')];

        const delay = Math.floor(time/dots.length);
        let timeDelay = 0;

        dots.forEach(dot => {
            console.log(timeDelay)

            setTimeout(()=> {
                dot.style.opacity = '0';
            }, timeDelay);

            timeDelay += delay;
        });
    }

    const arrowClick = (e) => {
        if (isAudioStarted) return;
        isAudioStarted = true;

        arrow.classList.add('active');

        arrow.style.left = (track.clientWidth - arrow.clientWidth - (round.clientWidth - arrow.clientWidth) / 2 - 1) + 'px';
        hideDots();

        setTimeout(() => {
            round.append(arrow);
            arrow.style.position = 'static';
            arrow.style.transform = 'none';


            setTimeout(() => {
                locker.remove();
                document.body.style.overflow = '';

                audio.play().catch((e) => {
                    console.error('Ошибка воспроизведения:', e);
                });

                document.addEventListener('visibilitychange', (e) => {

                    if (document.visibilityState === "hidden") {
                        audio.pause();
                    } else {
                        audio.play().catch((e) => {
                            console.error('Ошибка воспроизведения:', e);
                        });
                    }
                });
            }, 200);
        }, 800);


    };
    arrow.addEventListener('click', arrowClick);

    arrow.addEventListener('touchstart', (e) => {
        e.preventDefault();
        arrowClick();

    }, {passive: false});

    arrow.addEventListener('pointerdown', (e) => {
        e.preventDefault();
        arrowClick();
    }, {passive: false});


</script>


</body>
</html>
